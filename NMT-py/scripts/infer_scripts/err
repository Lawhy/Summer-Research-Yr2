#!/usr/bin/env bash
set -e
# Must be used in the infer directory

lan=$1
shift 
echo "language: $lan"

t_steps=$1
shift
echo "Training steps: $t_steps"

let i=t_steps-900
cls=$1
shift
echo "Clusters: $cls"

main_dir=/disk/ocean/lhe/transliteration/nmt-py #The same main dir as in the ez-training script

_dev_="_dev_"
_dev="_dev"
_dev="_dev"
_tst="_tst"

# copy the target dev/tst files to the infer directory
if [ $lan != "ar" ]
then
   cp $main_dir/data/$lan/bs/$lan$_dev.txt .
   cp $main_dir/data/$lan/bs/$lan$_tst.txt .
fi

if [ $lan = "ar" ]
then
   cp $main_dir/data/$lan/bs/en_dev.txt .
   cp $main_dir/data/$lan/bs/en_tst.txt .
   lan=en
fi

# -----WER-------  
# (In python3 venv)

while [ $i -le $t_steps ]
do 
  python wer.py $cls$_dev_$i.txt $lan$_dev.txt >> wer.txt 
  echo $i >> wer.txt
  let i+=100
done  
# -----CER-------
let i=t_steps-900  
while [ $i -le $t_steps ]
do
   wer $lan$_dev.txt original_$cls$_dev_$i.txt >> cer.txt
   echo $i >> cer.txt
   let i+=100
done

python cer.py $t_steps

python bst_ckp.py wer.txt cer-clean.txt
